/** biome-ignore-all lint/a11y/noNoninteractiveElementInteractions: Default
 biome-ignore-all lint/a11y/noSvgWithoutTitle: Default
 biome-ignore-all lint/a11y/noStaticElementInteractions: Default */
"use client";

import { cn } from "@foundry/ui/lib/utils";
import type { Variants } from "motion/react";
import { motion, useAnimation } from "motion/react";
import type { HTMLAttributes } from "react";
import { forwardRef, useCallback, useImperativeHandle, useRef } from "react";

export interface MusicalNoteIconHandle {
    startAnimation: () => void;
    stopAnimation: () => void;
}

interface MusicalNoteIconProps extends HTMLAttributes<HTMLDivElement> {
    size?: number;
}

const NOTE_VARIANTS: Variants = {
    normal: {
        rotate: 0,
        y: 0,
    },
    animate: {
        rotate: [0, -5, 5, -5, 5, 0],
        y: [0, -1, 1, -1, 1, 0],
        transition: {
            duration: 0.5,
            ease: "easeInOut",
        },
    },
};

const MusicalNoteIcon = forwardRef<MusicalNoteIconHandle, MusicalNoteIconProps>(({ onMouseEnter, onMouseLeave, className, size = 28, ...props }, ref) => {
    const controls = useAnimation();
    const isControlledRef = useRef(false);

    useImperativeHandle(ref, () => {
        isControlledRef.current = true;

        return {
            startAnimation: () => controls.start("animate"),
            stopAnimation: () => controls.start("normal"),
        };
    });

    const handleMouseEnter = useCallback(
        (e: React.MouseEvent<HTMLDivElement>) => {
            if (isControlledRef.current) {
                onMouseEnter?.(e);
            } else {
                controls.start("animate");
            }
        },
        [controls, onMouseEnter]
    );

    const handleMouseLeave = useCallback(
        (e: React.MouseEvent<HTMLDivElement>) => {
            if (isControlledRef.current) {
                onMouseLeave?.(e);
            } else {
                controls.start("normal");
            }
        },
        [controls, onMouseLeave]
    );

    return (
        <div className={cn(className)} onMouseEnter={handleMouseEnter} onMouseLeave={handleMouseLeave} {...props}>
            <motion.svg
                animate={controls}
                fill="none"
                height={size}
                initial="normal"
                stroke="currentColor"
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth="1.5"
                variants={NOTE_VARIANTS}
                viewBox="0 0 24 24"
                width={size}
                xmlns="http://www.w3.org/2000/svg"
            >
                <path d="M9 9L19.5 6M19.5 12.5528V16.3028C19.5 17.3074 18.834 18.1903 17.8681 18.4663L16.5481 18.8434C15.3964 19.1724 14.25 18.3077 14.25 17.1099C14.25 16.305 14.7836 15.5975 15.5576 15.3764L17.8681 14.7163C18.834 14.4403 19.5 13.5574 19.5 12.5528ZM19.5 12.5528V2.25L9 5.25V15.5528M9 15.5528V19.3028C9 20.3074 8.33405 21.1903 7.36812 21.4663L6.04814 21.8434C4.89645 22.1724 3.75 21.3077 3.75 20.1099C3.75 19.305 4.2836 18.5975 5.05757 18.3764L7.36812 17.7163C8.33405 17.4403 9 16.5574 9 15.5528Z" />
            </motion.svg>
        </div>
    );
});

MusicalNoteIcon.displayName = "MusicalNoteIcon";

export { MusicalNoteIcon };
